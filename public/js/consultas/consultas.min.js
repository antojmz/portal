var limpiar=limpiarEstados=limpiarDetalles=limpiarTrazas=limpiarReferencias=printCounter=ajax=0;var RegistroDTE=RegistroDTE2="";var parametroAjax={token:$("input[name=_token]").val(),tipo:"POST",data:{},ruta:"",async:false};
var ManejoRespuestaC=function(b){if(b.code="200"){var a=JSON.parse(b.respuesta.status);if(a.code=="-1"){toastr.warning(a.des_code,"Aviso!");}if(a.code=="204"){cargartablaReportes(b.respuesta.data);
}}else{toastr.error("No se ejecuto la consulta, contacte al personal informático","Error!");}};var ManejoRespuestaD=function(a){if(a.code="200"){pintarDatos(RegistroDTE);
cargartablaDetalles(a.respuesta.v_dte_detalles);cargartablaReferencias(a.respuesta.v_dte_referencias);cargartablaEstados(a.respuesta.v_dte_estados);}else{toastr.error("No se ejecuto la consulta, contacte al personal informático","Error!");
}};var ManejoRespuestaT=function(a){if(a.code="200"){cargartablaTrazas(a.respuesta.v_dte_estados);}else{toastr.error("No se ejecuto la consulta, contacte al personal informático","Error!");
}};var pintarDatos=function(a){if(a.TipoDTE!=null){$("#TipoDTE").text(a.TipoDTE);}if(a.FolioDTE!=null){$("#FolioDTE").text(a.FolioDTE);}if(a.FechaEmision!=null){$("#FechaEmision").text(a.FechaEmision);
}if(a.FechaRecepcion!=null){$("#FechaRecepcion").text(a.FechaRecepcion);}if(a.RutProveedor!=null){$("#RutProveedor").text(a.RutProveedor);}if(a.NombreProveedor!=null){$("#NombreProveedor").text(a.NombreProveedor);
}if(a.RutCliente!=null){$("#RutCliente").text(a.RutCliente);}if(a.NombreCliente!=null){$("#NombreCliente").text(a.NombreCliente);}if(a.MontoNetoCLP!=null){$("#MontoNetoCLP").text(a.MontoNetoCLP);
}if(a.MontoExentoCLP!=null){$("#MontoExentoCLP").text(a.MontoExentoCLP);}if(a.MontoIVACLP!=null){$("#MontoIVACLP").text(a.MontoIVACLP);}if(a.MontoTotalCLP!=null){$("#MontoTotalCLP").text(a.MontoTotalCLP);
}if(a.EstadoActualDTE!=null){$("#EstadoActualDTE").text(a.EstadoActualDTE);}if(a.FechaEstadoActualDTE!=null){$("#FechaEstadoActualDTE").text(a.FechaEstadoActualDTE);
}};var cargartablaDetalles=function(a){if(limpiarDetalles==1){destruirTabla("#tablaDetalles");}$("#tablaDetalles").dataTable({aLengthMenu:DataTableLengthMenu,scrollCollapse:true,pagingType:"full_numbers",language:LenguajeTabla,data:a,columns:[{title:"IdDTE",data:"IdDTE",visible:0},{title:"Código Producto",data:"CodigoProducto"},{title:"Nombre Producto",data:"NombreProducto"},{title:"Valor Unitario",data:"ValorUnitario"},{title:"Cantidad",data:"Cantidad"},{title:"Total Linea",data:"TotalLinea"}],});
limpiarDetalles=1;};var cargartablaReferencias=function(a){if(limpiarReferencias>0){destruirTabla("#tablaReferencias");}$("#tablaReferencias").dataTable({aLengthMenu:DataTableLengthMenu,scrollCollapse:true,pagingType:"full_numbers",language:LenguajeTabla,data:a,columns:[{title:"IdDTE",data:"IdDTE",visible:0},{title:"IdReferencia",data:"IdReferencia",visible:0},{title:"Tipo de Referencia",data:"TipoReferencia"},{title:"Folio de Referencia",data:"FolioReferencia"},{title:"Fecha de Referencia",data:"FechaReferencia",render:function(c,b,f,e){if(b==="display"){c=moment(c,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return c;}},],});limpiarReferencias=1;};var cargartablaEstados=function(a){if(limpiarEstados>0){destruirTabla("#tablaEstados");}$("#tablaEstados").dataTable({aLengthMenu:DataTableLengthMenu,scrollCollapse:true,pagingType:"full_numbers",language:LenguajeTabla,data:a,columns:[{title:"IdDTE",data:"IdDTE",visible:0},{title:"IdEstadoDTE",data:"IdEstadoDTE",visible:0},{title:"Fecha de Estado",data:"FechaEstado",render:function(c,b,f,e){if(b==="display"){c=moment(c,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return c;}},{title:"Comentario de Estado",data:"ComentarioEstado"}],});limpiarEstados=1;};var cargartablaTrazas=function(a){if(limpiarTrazas>0){destruirTabla("#tablaTrazas");
}$("#tablaTrazas").dataTable({aLengthMenu:DataTableLengthMenu,scrollCollapse:true,pagingType:"full_numbers",language:LenguajeTabla,data:a,columns:[{title:"IdDTE",data:"IdDTE",visible:0},{title:"IdEstadoDTE",data:"IdEstadoDTE",visible:0},{title:"Fecha de Estado",data:"FechaEstado",render:function(c,b,f,e){if(b==="display"){c=moment(c,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return c;}},{title:"Comentario de Estado",data:"ComentarioEstado"}],});limpiarTrazas=1;};var cargartablaReportes=function(a){if(limpiar>0){destruirTabla("#tablaReportes");
}var b=[[4],[5],[6],[7],[8],[9],[10],[11],[12],[13],[14],[15],[16],[17],[18],[19],[20],[21],[22],[23],[24]];$("#tablaReportes").dataTable({aLengthMenu:DataTableLengthMenu,scrollX:true,scrollY:"45vh",scrollCollapse:true,pagingType:"full_numbers",language:LenguajeTabla,data:a,columns:[{title:"IdDTE",data:"IdDTE",visible:0},{title:"IdProveedor",data:"IdProveedor",visible:0},{title:"IdCliente",data:"IdCliente",visible:0},{title:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",data:{PdfDTE:"PdfDTE",XmlDTE:"XmlDTE"},orderable:false,render:function(e,c,g,f){if(c==="display"){e='<center><a target="_blank" class="m-menu__link" data-toggle="tooltip" title="XML" href="'+e.XmlDTE+'"><i class="fa fa-file-code-o" aria-hidden="true"></i></a>&nbsp;&nbsp;<a target="_blank" class="m-menu__link" data-toggle="tooltip" title="PDF" href="'+e.PdfDTE+'"><i class="fa fa-file-pdf-o" aria-hidden="true"></i></a>&nbsp;&nbsp;<a id="LinkTrazas" class="m-menu__link" data-toggle="tooltip" title="Traza DTE" href="#"><i class="fa fa-history" aria-hidden="true"></i></a></center>';
}return e;}},{title:"Tipo DTE",data:"TipoDTE"},{title:"Folio DTE",data:"FolioDTE"},{title:"Fecha Emisión",data:"FechaEmision",render:function(e,c,g,f){if(c==="display"){e=moment(e,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return e;}},{title:"Fecha Recepción",data:"FechaRecepcion",render:function(e,c,g,f){if(c==="display"){e=moment(e,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return e;}},{title:"RUT Proveedor",visible:false,data:"RutProveedor",render:function(e,c,g,f){if(c==="display"){e=formateaRut(e,true);}return e;}},{title:"Nombre Proveedor",data:"NombreProveedor",visible:false},{title:"RUT Cliente",data:"RutCliente",render:function(e,c,g,f){if(c==="display"){e=formateaRut(e,true);
}return e;}},{title:"Nombre Cliente",data:"NombreCliente"},{title:"Monto Neto DTE",data:"MontoNetoCLP"},{title:"Monto Exento DTE",data:"MontoExentoCLP"},{title:"Monto IVA DTE",data:"MontoIVACLP"},{title:"Monto Total DTE",data:"MontoTotalCLP"},{title:"Fecha Autorizacion SII",visible:false,data:"FechaAutorizacionSII",render:function(e,c,g,f){if(c==="display"){e=moment(e,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return e;}},{title:"Fecha OC",visible:false,data:"FechaOC",render:function(e,c,g,f){if(c==="display"){e=moment(e,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return e;}},{title:"Fecha Pago",visible:false,data:"FechaPago",render:function(e,c,g,f){if(c==="display"){e=moment(e,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return e;}},{title:"Fecha Vencimiento",visible:false,data:"FechaVencimiento",render:function(e,c,g,f){if(c==="display"){e=moment(e,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return e;}},{title:"Tipo Acuse",data:"DesTipoAcuse"},{title:"Existencia SII",data:"DesExistenciaSII",visible:false,},{title:"Existencia Paperles",data:"DesExistenciaPaperles"},{title:"Fecha de Estado Actual",data:"FechaEstadoActualDTE",render:function(e,c,g,f){if(c==="display"){e=moment(e,"YYYY-MM-DD HH:mm:ss",true).format("DD-MM-YYYY");
}return e;}},{title:"Estado Actual de Pago",data:"EstadoActualDTE"}],dom:"Bfrtip",buttons:[{extend:"print",text:"Imprimir",className:"btn m-btn--pill btn-accent btn-sm m-btn m-btn--custom",orientation:"landscape",pageSize:"TABLOID",title:"Listado de DTEs",exportOptions:{columns:b,modifier:{page:"all"}},customize:function(c){$(c.document.body).find("table").addClass("compact").css("font-size","11px");
}},{extend:"excel",text:"Exportar",className:"btn m-btn--pill btn-accent btn-sm m-btn m-btn--custom",title:"Listado DTEs",exportOptions:{columns:b,modifier:{page:"all"}}},{extend:"pdf",text:"PDF",className:"btn m-btn--pill btn-accent btn-sm m-btn m-btn--custom",orientation:"landscape",pageSize:"TABLOID",title:"Listado de DTEs",exportOptions:{columns:b,modifier:{page:"all",}},customize:function(e){e.defaultStyle.fontSize=8;
var c=new Array();$($("#tablaReportes").dataTable()).find("tbody tr:first-child td").each(function(){if($(this).attr("colspan")){for(var f=1;f<=$(this).attr("colspan");
$i++){c.push("*");}}else{c.push("*");}});e.content[1].table.widths=c;}}]});limpiar=1;if(a.length>0){SeleccionarTablaReportes();}};var SeleccionarTablaReportes=function(){var b=$("#tablaReportes").dataTable();
$("#tablaReportes tbody").on("click","tr",function(c){b.$("tr.selected").removeClass("selected");$(this).addClass("selected");});$("#tablaReportes tbody").on("dblclick","tr",function(){RegistroDTE=TablaTraerCampo("tablaReportes",this);
cargarFormularioVisualizacion(RegistroDTE);$("#ahref1").click();$("html,body").animate({scrollTop:$("#divSeparacion").offset().top});});var a=$("#tablaReportes").DataTable();
$("#tablaReportes tbody").on("click","tr",function(){RegistroDTE2=a.row(this).data();});};var ProcesarConsulta=function(){parametroAjax.ruta=ruta;parametroAjax.data=$("#FormConsultas").serialize();
respuesta=procesarajax(parametroAjax);ManejoRespuestaC(respuesta);};var cargarFormularioVisualizacion=function(a){if(a.length==0){return;}$(".divForm").toggle();
parametroAjax.ruta=rutaD;parametroAjax.data={IdDTE:a.IdDTE};respuesta=procesarajax(parametroAjax);ManejoRespuestaD(respuesta);};var BotonVolver=function(){$(".divForm").toggle();
$(".span").text("Desconocido");};var crearAllcombos=function(c){var a=[{id:"1",text:"Recibido"},{id:"2",text:"Por recibir"}];var b=[{id:"1",text:"Emitido por el proveedor"},{id:"2",text:"Recepcionado por el cliente"},{id:"2",text:"Contabilizado por el cliente"},{id:"2",text:"Programado para pago"}];
crearcombo("#Selectcampo",c.v_busq_consulta);crearcombo("#SelectDTE",c.v_tipo_dte);crearcombo("#TipoAcuse",a);crearcombo("#selectEstado",b);};var CargarTrazas=function(){parametroAjax.ruta=rutaT;
parametroAjax.data=RegistroDTE2;respuesta=procesarajax(parametroAjax);ManejoRespuestaT(respuesta);$("#ModalTrazas").modal("show");};var toggleFiltros=function(){$("#divForm").slideToggle("fast");
};var cal1=function(){$("#fecha").click();};var cal2=function(){$("#fechaA").click();};var cal3=function(){$("#fechaO").click();};var cal4=function(){$("#fechaP").click();
};var cal5=function(){$("#fechaV").click();};var cal6=function(){$("#fechaR").click();};$(document).ready(function(){ClassActive("LiDtes");cargartablaReportes(d.v_dtes);
$(".span").text("Desconocido");$("#spanTitulo").text("Consultas DTE");crearAllcombos(d);$("#RutCliente").rut();$("#RutProveedor").rut();$("#fecha").daterangepicker({},function(c,a,b){$("#fecha").text(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY")+" al "+moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
$("#f_desde").val(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));$("#f_hasta").val(moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
});$("#fechaA").daterangepicker({},function(c,a,b){$("#fechaA").text(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY")+" al "+moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
$("#f_desdeA").val(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));$("#f_hastaA").val(moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
});$("#fechaO").daterangepicker({},function(c,a,b){$("#fechaO").text(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY")+" al "+moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
$("#f_desdeO").val(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));$("#f_hastaO").val(moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
});$("#fechaP").daterangepicker({},function(c,a,b){$("#fechaP").text(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY")+" al "+moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
$("#f_desdeP").val(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));$("#f_hastaP").val(moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
});$("#fechaV").daterangepicker({},function(c,a,b){$("#fechaV").text(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY")+" al "+moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
$("#f_desdeV").val(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));$("#f_hastaV").val(moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
});$("#fechaR").daterangepicker({},function(c,a,b){$("#fechaR").text(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY")+" al "+moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
$("#f_desdeR").val(moment(c._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));$("#f_hastaR").val(moment(a._d,"MM-DD-YYYY HH:mm:ss",true).format("DD-MM-YYYY"));
});$(document).on("click","#consultar",ProcesarConsulta);$(document).on("click","#volver",BotonVolver);$(document).on("click","#LinkTrazas",CargarTrazas);
$(document).on("click","#ahrefFiltros",toggleFiltros);$(document).on("click","#btnCal1",cal1);$(document).on("click","#btnCal2",cal2);$(document).on("click","#btnCal3",cal3);
$(document).on("click","#btnCal4",cal4);$(document).on("click","#btnCal5",cal5);$(document).on("click","#btnCal6",cal6);});